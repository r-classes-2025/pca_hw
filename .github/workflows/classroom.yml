name: Autograde R Assignment

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout student code
        uses: actions/checkout@v3
        
      - name: Checkout private tests
        uses: actions/checkout@v3
        with:
          repository: r-classes-2025/r-grading-tests
          token: ${{ secrets.TEST_REPO_TOKEN }}  
          path: private-tests
          
      - name: Setup R
        uses: r-lib/actions/setup-r@v2
        
      - name: Install dependencies
        run: |
          R -e "install.packages('testthat')"
          
      - name: Run tests and generate report
        id: autograde
        run: |
          cd private-tests
          Rscript run_tests.R
          
          # Проверяем результат
          if [ $? -eq 0 ]; then
            echo "result=pass" >> $GITHUB_OUTPUT
            echo "score=1" >> $GITHUB_OUTPUT
          else
            echo "result=fail" >> $GITHUB_OUTPUT  
            echo "score=0" >> $GITHUB_OUTPUT
          fi
          
      - name: Display results
        run: |
          echo "Test result: ${{ steps.autograde.outputs.result }}"
          echo "Score: ${{ steps.autograde.outputs.score }}/1"